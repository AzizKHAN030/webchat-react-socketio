(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{217:function(e,a,n){"use strict";n.r(a);var t=n(0),s=n.n(t),r=n(35),c=n.n(r),o=(n(85),n(2)),i=n(37),u=n(4),l=n(24),d=n.n(l),m=n(116),j=Object(m.a)("http://194.195.241.142:8888",{transports:["websocket"]}),p=n(67),h=n.n(p),f=n(221),b=n(222),O=n(223),g=n(224),v=n(118),x=n(10);function w(e){var a=e.onLogin,n=s.a.useState(""),t=Object(u.a)(n,2),r=t[0],c=t[1],o=s.a.useState(""),l=Object(u.a)(o,2),m=l[0],j=l[1],p=s.a.useState(!1),f=Object(u.a)(p,2),b=f[0],w=f[1],y=function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r||!m){e.next=5;break}return w(!0),e.next=4,h.a.post("/rooms",{roomId:r,userName:m});case 4:a({roomId:r,userName:m});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(x.jsxs)(O.a,{name:"basic",className:"app__chat-auth",layout:"vertical",autoComplete:"off",children:[Object(x.jsx)(O.a.Item,{label:"RoomID",name:"roomId",rules:[{required:!0,message:"Please input RoomID!"}],children:Object(x.jsx)(g.a,{onChange:function(e){return c(e.target.value)}})}),Object(x.jsx)(O.a.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please input username!"}],children:Object(x.jsx)(g.a,{onChange:function(e){return j(e.target.value)}})}),Object(x.jsx)(O.a.Item,{wrapperCol:{offset:0,span:24},children:Object(x.jsx)(v.a,{type:"primary",loading:b,htmlType:"submit",onClick:y,children:"Enter"})})]})}var y=n(225),N=n(226);function S(e){var a=e.users,n=e.messages,t=e.roomId,r=e.userName,c=e.onAddMessage,o=s.a.useState(""),i=Object(u.a)(o,2),l=i[0],d=i[1],m=s.a.useRef(null),p=function(){l&&(j.emit("ROOM_NEW_MESSAGE",{userName:r,text:l,roomId:t}),c({userName:r,text:l}),d(""))};return s.a.useEffect((function(){m.current.scrollTo(0,9999)}),[n]),Object(x.jsx)(x.Fragment,{children:Object(x.jsxs)(f.a,{className:"chat",children:[Object(x.jsxs)(b.a,{className:"chat__users",span:6,children:[Object(x.jsxs)("h2",{children:["Room: ",t]}),Object(x.jsx)(y.a,{count:a.length,className:"online",status:"success",children:"Online"}),Object(x.jsx)("ul",{className:"users",children:a.map((function(e){return e===r?Object(x.jsx)("li",{className:"me",children:"You"},e):Object(x.jsx)("li",{children:e},e)}))})]}),Object(x.jsxs)(b.a,{className:"chat__messages",span:18,children:[Object(x.jsx)("div",{className:"messages",ref:m,children:n.map((function(e){return Object(x.jsxs)("div",{className:e.userName===r?"message incoming":"message",children:[Object(x.jsx)("p",{children:e.text}),Object(x.jsx)("span",{children:e.userName})]})}))}),Object(x.jsxs)("div",{className:"inputs",children:[Object(x.jsx)(g.a,{placeholder:"Type your message",value:l,onChange:function(e){d(e.target.value)},onKeyPress:function(e){13===e.charCode&&p()}}),Object(x.jsx)(v.a,{onClick:p,icon:Object(x.jsx)(N.a,{}),type:"primary"})]})]})]})})}var E=n(6),_=function(e,a){switch(a.type){case"IS_AUTH":return Object(o.a)(Object(o.a)({},e),{},{isAuth:!0,userName:a.payload.userName,roomId:a.payload.roomId});case"SET_USERS":return Object(o.a)(Object(o.a)({},e),{},{users:a.payload});case"SET_DATA":return Object(o.a)(Object(o.a)({},e),{},{users:a.payload.users,messages:a.payload.messages});case"NEW_MESSAGE":return Object(o.a)(Object(o.a)({},e),{},{messages:[].concat(Object(E.a)(e.messages),[a.payload])});default:return e}};var k=function(){var e=s.a.useReducer(_,{isAuth:!1,roomId:null,userName:null,users:[],messages:[]}),a=Object(u.a)(e,2),n=a[0],t=a[1],r=function(e){t({type:"SET_USERS",payload:e})},c=function(e){t({type:"NEW_MESSAGE",payload:e})};s.a.useEffect((function(){j.on("ROOM_SET_USERS",r),j.on("ROOM_NEW_MESSAGE",c)}),[]);var l=function(){var e=Object(i.a)(d.a.mark((function e(a){var n,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j.emit("ROOM_JOIN",a),console.log(a.roomId),e.next=4,h.a.get("/rooms/".concat(a.roomId));case 4:n=e.sent,s=n.data,t({type:"IS_AUTH",payload:a}),t({type:"SET_DATA",payload:s});case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return Object(x.jsx)("div",{className:"app",children:Object(x.jsx)(f.a,{className:"app__wrapper",justify:"center",align:"middle",children:Object(x.jsx)(b.a,{className:"app__chat",span:22,children:n.isAuth?Object(x.jsx)(S,Object(o.a)(Object(o.a)({},n),{},{onAddMessage:c})):Object(x.jsx)(w,{onLogin:l})})})})},I=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function A(e,a){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),a&&a.onUpdate&&a.onUpdate(e)):(console.log("Content is cached for offline use."),a&&a.onSuccess&&a.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(Object(x.jsx)(k,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var a="".concat("","/service-worker.js");I?(!function(e,a){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var t=n.headers.get("content-type");404===n.status||null!=t&&-1===t.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):A(e,a)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(a,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):A(a,e)}))}}()},85:function(e,a,n){}},[[217,1,2]]]);
//# sourceMappingURL=main.0a808e52.chunk.js.map