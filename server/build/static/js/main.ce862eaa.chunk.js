(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{228:function(e,a,s){"use strict";s.r(a);var t=s(0),n=s.n(t),c=s(35),r=s.n(c),o=(s(94),s(33)),u=s(53),l=s.n(u),i=s(68),j=s(44),m=s(127),p=Object(m.a)("http://localhost:8888",{transports:["websocket"]}),d=s(70),O=s.n(d),b=s(232),h=s(233),f=s(234),x=s(235),g=s(129),y=s(8);function N(e){var a=e.onLogin,s=n.a.useState(""),t=Object(j.a)(s,2),c=t[0],r=t[1],o=n.a.useState(""),u=Object(j.a)(o,2),m=u[0],p=u[1],d=n.a.useState(!1),b=Object(j.a)(d,2),h=b[0],N=b[1],S=function(){var e=Object(i.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c||!m){e.next=5;break}return N(!0),e.next=4,O.a.post("/rooms",{roomId:c,userName:m});case 4:a({roomId:c,userName:m});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(y.jsxs)(f.a,{name:"basic",className:"app__chat-auth",layout:"vertical",autoComplete:"off",children:[Object(y.jsx)(f.a.Item,{label:"RoomID",name:"roomId",rules:[{required:!0,message:"Please input RoomID!"}],children:Object(y.jsx)(x.a,{onChange:function(e){return r(e.target.value)}})}),Object(y.jsx)(f.a.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please input username!"}],children:Object(y.jsx)(x.a,{onChange:function(e){return p(e.target.value)}})}),Object(y.jsx)(f.a.Item,{wrapperCol:{offset:0,span:24},children:Object(y.jsx)(g.a,{type:"primary",loading:h,htmlType:"submit",onClick:S,children:"Enter"})})]})}var S=s(236),_=s(237);function E(e){var a=e.users,s=e.messages,t=e.roomId,c=e.userName,r=e.onAddMessage,o=n.a.useState(""),u=Object(j.a)(o,2),l=u[0],i=u[1],m=n.a.useRef(null),d=function(){l&&(p.emit("ROOM_NEW_MESSAGE",{userName:c,text:l,roomId:t}),r({userName:c,text:l}),i(""))};return n.a.useEffect((function(){m.current.scrollTo(0,9999)}),[s]),Object(y.jsx)(y.Fragment,{children:Object(y.jsxs)(b.a,{className:"chat",children:[Object(y.jsxs)(h.a,{className:"chat__users",span:6,children:[Object(y.jsxs)("h2",{children:["Room: ",t]}),Object(y.jsx)(S.a,{count:a.length,className:"online",status:"success",children:"Online"}),Object(y.jsx)("ul",{className:"users",children:a.map((function(e){return e===c?Object(y.jsx)("li",{className:"me",children:"You"},e):Object(y.jsx)("li",{children:e},e)}))})]}),Object(y.jsxs)(h.a,{className:"chat__messages",span:18,children:[Object(y.jsx)("div",{className:"messages",ref:m,children:s.map((function(e){return Object(y.jsxs)("div",{className:e.userName===c?"message incoming":"message",children:[Object(y.jsx)("p",{children:e.text}),Object(y.jsx)("span",{children:e.userName})]})}))}),Object(y.jsxs)("div",{className:"inputs",children:[Object(y.jsx)(x.a,{placeholder:"Type your message",value:l,onChange:function(e){i(e.target.value)},onKeyPress:function(e){13===e.charCode&&d()}}),Object(y.jsx)(g.a,{onClick:d,icon:Object(y.jsx)(_.a,{}),type:"primary"})]})]})]})})}var v=s(130),I=function(e,a){switch(a.type){case"IS_AUTH":return Object(o.a)(Object(o.a)({},e),{},{isAuth:!0,userName:a.payload.userName,roomId:a.payload.roomId});case"SET_USERS":return Object(o.a)(Object(o.a)({},e),{},{users:a.payload});case"SET_DATA":return Object(o.a)(Object(o.a)({},e),{},{users:a.payload.users,messages:a.payload.messages});case"NEW_MESSAGE":return Object(o.a)(Object(o.a)({},e),{},{messages:[].concat(Object(v.a)(e.messages),[a.payload])});default:return e}};var A=function(){var e=n.a.useReducer(I,{isAuth:!1,roomId:null,userName:null,users:[],messages:[]}),a=Object(j.a)(e,2),s=a[0],t=a[1],c=function(e){t({type:"SET_USERS",payload:e})},r=function(e){t({type:"NEW_MESSAGE",payload:e})};n.a.useEffect((function(){p.on("ROOM_SET_USERS",c),p.on("ROOM_NEW_MESSAGE",r)}),[]);var u=function(){var e=Object(i.a)(l.a.mark((function e(a){var s,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.emit("ROOM_JOIN",a),console.log(a.roomId),e.next=4,O.a.get("/rooms/".concat(a.roomId));case 4:s=e.sent,n=s.data,t({type:"IS_AUTH",payload:a}),t({type:"SET_DATA",payload:n});case 8:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return Object(y.jsx)("div",{className:"app",children:Object(y.jsx)(b.a,{className:"app__wrapper",justify:"center",align:"middle",children:Object(y.jsx)(h.a,{className:"app__chat",span:22,children:s.isAuth?Object(y.jsx)(E,Object(o.a)(Object(o.a)({},s),{},{onAddMessage:r})):Object(y.jsx)(N,{onLogin:u})})})})};r.a.render(Object(y.jsx)(A,{}),document.getElementById("root"))},94:function(e,a,s){}},[[228,1,2]]]);
//# sourceMappingURL=main.ce862eaa.chunk.js.map